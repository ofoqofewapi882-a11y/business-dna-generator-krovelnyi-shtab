import React, { useState } from 'react';
import ReactMarkdown from 'react-markdown';
import remarkGfm from 'remark-gfm';
import { FileText, Calendar, Users } from 'lucide-react';

interface Protocol {
    id: string;
    title: string;
    date: string;
    content: string;
    summary: string;
}

const protocols: Protocol[] = [
    {
        id: '1',
        title: 'ПРОТОКОЛ ВСТРЕЧИ',
        date: '17 февраля 2026 года',
        summary: `
## Основные итоги встречи

**Суть:** Обсуждение стратегии выхода на B2B рынок (генподрядчики, промышленные предприятия) и создание маркетинговых материалов.

**Ключевые преимущества:**
*   Собственные бригады и аттестация Технониколь.
*   Полное техническое оснащение (станки, дефектоскоп).
*   Гарантия качества и опыт сложных объектов (химпром, высотные здания).

**План действий:**
*   **1 месяц:** Сайт, буклет, 3 кейса.
*   **2-3 месяца:** CRM, Яндекс.Бизнес, корпоративная почта.
*   **3-6 месяцев:** Выход на рынок Москвы.

**Следующие шаги:**
*   Подготовка ответов на вопросы о компании (до 22.02).
*   Разработка вариантов дизайна (до 24.02).
*   Созвон для согласования (25.02).
        `,
        content: `# ПРОТОКОЛ ВСТРЕЧИ

**Заказчик:** Студия Кровли
**Дата:** 17 февраля 2026 года
**Участники:**

- Илья (генеральный директор), Константин (собственник)
- Тузов Алексей (исполнитель)

***

## Суть встречи

Обсудили создание сайта, буклета и кейсов для работы с крупными заказчиками в Твери и Москве. Определили, как обосновать цену выше рынка, какие материалы нужны, что делать дальше.

***

## Главное отличие от конкурентов

**Проблема рынка:** 80-90% подрядчиков работают с фрилансерами, китайским оборудованием, без сертификации — делают быстро и дешево, качество нестабильное.

**Наше отличие:**

- Собственные бригады с регулярным обучением у Технониколь
- Полное техническое оснащение: 6 сварочных станков по 2 млн руб., дефектоскоп Изотест (единственный в регионе), автономные бытовки, транспорт
- Одна из трех компаний в Твери с аттестацией Технониколь, единственная в Тверской области с действующими сертификатами у сотрудников
- Дополнительная гарантия от производителя через службу качества (трехэтапный контроль монтажа)
- Опыт сложных объектов: химпром, взрывоопасные производства, высотные здания до 40 метров

**Результат:** цена выше на 30-50%, но клиент получает кровлю без переделок, с долгим сроком службы и заводской гарантией.

***

## Целевая аудитория

Два сегмента B2B:

1. **Генподрядчики** на объектах нового строительства — выбирают субподрядчиков по кровельным работам
2. **Инженерные службы предприятий** (начальники ОКС, главные инженеры) — ремонтируют и обслуживают кровли производственных площадей

**Не работаем:** частные заказчики (коттеджи, беседки) — можем взять разово при наличии времени, но не целевой сегмент.

***

## Выявленные задачи

### Первоочередные (1 месяц)

1. **Создать минимальный комплект материалов:** сайт, PDF-буклет, 3+ готовых кейса с фото
2. **Обосновать стоимость услуг:** показать оборудование, сертификаты, примеры сложных проектов
3. **Собрать базу знаний о компании:** структурировать информацию для быстрого создания контента

### Среднесрочные (2-3 месяца)

4. **Запустить учет лидов:** CRM или таблица для входящих заявок, отслеживание конверсии
5. **Создать точки контакта:** Яндекс.Бизнес с отзывами, корпоративная почта на своем домене, городской телефон

### Долгосрочные (3-6 месяцев)

6. **Выйти на московский рынок:** адаптация сайта под регион, SEO-продвижение, возможно покупка старого домена для ускорения индексации

***

## Проблемы и их последствия

1. **Нет структурированных данных о компании**
*Последствие:* невозможно быстро подготовить презентацию, КП или ответить на типовые вопросы заказчиков
2. **Зависимость от одного партнера (Пальметто ТГМ Интернешнл)**
*Последствие:* 90% заказов через одну компанию — риск потери большей части выручки при разрыве отношений или снижении их объемов. Благодаря партнеру накоплен опыт крупных и сложных проектов, но собственная клиентская база минимальна
3. **Клиенты не находят компанию в интернете**
*Последствие:* входящие заявки уходят конкурентам, даже менее квалифицированным. Нет органического потока лидов
4. **Сложно объяснить разницу в цене в 2-3 раза**
*Последствие:* потенциальные клиенты отсеиваются на этапе первого контакта, не дойдя до понимания ценности
5. **Нет визуальных материалов**
*Последствие:* невозможно показать масштаб проектов, техническое оснащение, процесс работы. Имеющиеся фото требуют ретуши
6. **Отсутствие корпоративных контактов**
*Последствие:* для B2B-клиента мобильный телефон и почта на mail.ru выглядят несерьезно, снижают доверие
7. **Не определен минимальный чек и география**
*Последствие:* тратим время на мелкие заказы или нерентабельные удаленные объекты

***

## Ключевые решения

**По оптимизации проектов:**
Бесплатно анализируем проектную документацию заказчика — оптимизируем стоимость, улучшаем теплотехнику, сокращаем сроки монтажа. Часто предлагаем замену устаревших решений (2 слоя ваты) на современные (вата + полимерный утеплитель) — дешевле, теплее, долговечнее.

**По ценообразованию:**
Привязать стоимость к стандартным кровельным системам Технониколь для прозрачности. Сформировать продуктовую линейку: аудит кровли, оптимизация проекта, реализация под ключ, сервисное обслуживание.

**По работе:**
Коммуникация через Telegram-группу, ответы на вопросы голосом для скорости. Быстрые итерации с согласованиями в течение 1-3 дней.

***

## Критические зависимости

Что может сорвать сроки:

- **Скорость обратной связи** от Ильи и Константина — нужны голосовые/текстовые ответы на вопросы о компании в течение 2-3 дней
- **Качество фотоматериалов** — если потребуется пересъемка объектов или оборудования, добавится 1-2 недели
- **Согласование визуального стиля** — возможны 2-3 итерации, каждая +2-3 дня
- **Наличие готовой информации по проектам** — для кейсов нужны: адрес объекта, площадь, сроки, особенности, фото до/после

***

## План работ на неделю

| Срок | Кто | Что делает |
| :-- | :-- | :-- |
| До 19.02 | Алексей | Отправляет список вопросов для аудио-ответов о компании, целевой аудитории, конкурентах |
| До 22.02 | Илья, Константин | Записывают ответы голосом или текстом в Telegram-группе |
| До 24.02 | Алексей | Готовит 3-5 вариантов визуального стиля на основе логотипа и примеров сайтов |
| До 24.02 | Илья, Константин | Присылают фото оборудования, бытовок, объектов для обработки |
| 25.02 | Все | Созвон: выбор дизайна, уточнение деталей, корректировка контента |


***

## Критерии успеха первого этапа

- Согласован визуальный стиль (цвета, типографика, общий тон)
- Готова первая версия текстов "О компании" и "Почему мы"
- Собрано минимум 3 кейса с фото и описаниями
- Создан прототип главной страницы сайта

**Срок закрытия этапа:** конец первой недели марта 2026

***

## Следующая встреча

**Формат:** созвон
**Дата:** 25 февраля 2026
**Повестка:** выбор визуального направления, проверка первых текстов, обсуждение кейсов
`
    }
];

const MeetingMinutes: React.FC = () => {
    const [selectedProtocol, setSelectedProtocol] = useState<Protocol>(protocols[0]);
    const [viewMode, setViewMode] = useState<'summary' | 'full'>('summary');

    return (
        <div className="flex flex-col md:flex-row h-full min-h-[600px]">
            {/* Sidebar List */}
            <div className="md:w-1/3 border-r border-slate-200 bg-slate-50">
                <div className="p-4 border-b border-slate-200">
                    <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                        <Calendar className="w-5 h-5 text-indigo-600" />
                        Список встреч
                    </h2>
                </div>
                <div className="overflow-y-auto max-h-[600px]">
                    {protocols.map((protocol) => (
                        <button
                            key={protocol.id}
                            onClick={() => setSelectedProtocol(protocol)}
                            className={`w-full text-left p-4 hover:bg-white transition-colors border-b border-slate-100 ${selectedProtocol.id === protocol.id ? 'bg-white border-l-4 border-l-indigo-600 shadow-sm' : 'border-l-4 border-l-transparent'
                                }`}
                        >
                            <div className="font-semibold text-slate-800">{protocol.title}</div>
                            <div className="text-sm text-slate-500 mt-1 flex items-center gap-1">
                                <Calendar className="w-3 h-3" />
                                {protocol.date}
                            </div>
                        </button>
                    ))}
                </div>
            </div>

            {/* Content Area */}
            <div className="md:w-2/3 p-6 md:p-10 overflow-y-auto max-h-[800px] bg-slate-50">
                {selectedProtocol ? (
                    <div className="flex flex-col h-full">
                        <div className="flex space-x-6 mb-6 border-b border-slate-200">
                            <button
                                onClick={() => setViewMode('summary')}
                                className={`pb-3 px-1 font-medium text-sm transition-all relative ${viewMode === 'summary'
                                    ? 'text-indigo-600'
                                    : 'text-slate-500 hover:text-slate-700'
                                    }`}
                            >
                                Краткая выжимка
                                {viewMode === 'summary' && (
                                    <span className="absolute bottom-0 left-0 w-full h-0.5 bg-indigo-600 rounded-t-full" />
                                )}
                            </button>
                            <button
                                onClick={() => setViewMode('full')}
                                className={`pb-3 px-1 font-medium text-sm transition-all relative ${viewMode === 'full'
                                    ? 'text-indigo-600'
                                    : 'text-slate-500 hover:text-slate-700'
                                    }`}
                            >
                                Полный текст
                                {viewMode === 'full' && (
                                    <span className="absolute bottom-0 left-0 w-full h-0.5 bg-indigo-600 rounded-t-full" />
                                )}
                            </button>
                        </div>

                        <div className={`flex-grow ${viewMode === 'full' ? 'bg-white shadow-sm p-8 md:p-12 rounded-sm border border-slate-100' : ''}`}>
                            <div className={`prose prose-slate max-w-none ${viewMode === 'full' ? 'prose-lg font-serif max-w-2xl mx-auto leading-relaxed' : ''}`}>
                                <ReactMarkdown
                                    remarkPlugins={[remarkGfm]}
                                    components={{
                                        img: ({ node, ...props }) => <img style={{ maxWidth: '100%' }} {...props} />,
                                        table: ({ node, ...props }) => <div className="overflow-x-auto my-4 border rounded-lg"><table className="w-full text-sm text-left text-slate-500" {...props} /></div>,
                                        thead: ({ node, ...props }) => <thead className="text-xs text-slate-700 uppercase bg-slate-50" {...props} />,
                                        th: ({ node, ...props }) => <th className="px-6 py-3 font-semibold" {...props} />,
                                        td: ({ node, ...props }) => <td className="px-6 py-4 border-t" {...props} />,
                                    }}
                                >
                                    {viewMode === 'summary' ? selectedProtocol.summary : selectedProtocol.content}
                                </ReactMarkdown>
                            </div>
                        </div>
                    </div>
                ) : (
                    <div className="flex flex-col items-center justify-center h-full text-slate-400">
                        <FileText className="w-16 h-16 mb-4 opacity-20" />
                        <p>Выберите протокол для просмотра</p>
                    </div>
                )}
            </div>
        </div>
    );
};

export default MeetingMinutes;
